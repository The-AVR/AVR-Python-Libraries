asyncapi: "2.5.0"
info:
    title: Bell AVR MQTT Message Spec
    version: "1.0"
channels:
    avr/pcm/color/set:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMColorSet"
            description: "This sets the color of the LED strip on the PCC."
    avr/pcm/color/timed:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMColorTimed"
            description: "This sets the color of the LED strip on the PCC temporarily."
    avr/pcm/laser/fire:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMLaserFire"
            description: "Fires the laser for a 0.25 second pulse. Has a cooldown of 0.5 seconds."
    avr/pcm/laser/on:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMLaserOn"
            description: "Turns on laser (in blip mode - 0.1 second on every 0.5. sec)."
    avr/pcm/laser/off:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMLaserOff"
            description: "Turns off laser (laser off from blip mode - but doesn't prevent fire_laser)."
    avr/pcm/servo/open:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMServoOpen"
            description: "Opens a specific servo."
    avr/pcm/servo/close:
        publish:
            message:
                $ref: "#/components/messages/AVRPCMServoClose"
            description: "Closes a specific servo."
components:
    messages:
        AVRPCMColorSet:
            payload:
                type: object
                additionalProperties: false
                required: ["wrgb"]
                properties:
                    wrgb:
                        description: A list of 4 integers between 0 and 255 to set the base color of the LEDs. This is in order of Red, Green, Blue, and Alpha
                        type: array
                        minItems: 4
                        maxItems: 4
                        items:
                            description: Color value
                            type: integer
                            # this breaks type-hinting
                            # minimum: 0
                            # maximum: 255

        AVRPCMColorTimed:
            payload:
                type: object
                additionalProperties: false
                required: ["wrgb", "time"]
                properties:
                    wrgb:
                        description: A list of 4 integers between 0 and 255 to set the base color of the LEDs. This is in order of Red, Green, Blue, and Alpha
                        type: array
                        minItems: 4
                        maxItems: 4
                        items:
                            description: Color value
                            type: integer
                            # this breaks type-hinting
                            # minimum: 0
                            # maximum: 255
                    time:
                        description: Optional `float` for the number of seconds the color should be set for. Default is 0.5.
                        type: number
                        minimum: 0
                        default: 0.5

        AVRPCMLaserFire:
            payload:
                type: object
                additionalProperties: false

        AVRPCMLaserOn:
            payload:
                type: object
                additionalProperties: false

        AVRPCMLaserOff:
            payload:
                type: object
                additionalProperties: false

        AVRPCMServoOpen:
            payload:
                type: object
                additionalProperties: false
                required: ["servo"]
                properties:
                    servo:
                        description: ID of the servo to open. This is 0-indexed.
                        type: integer
                        minimum: 0

        AVRPCMServoClose:
            payload:
                type: object
                additionalProperties: false
                required: ["servo"]
                properties:
                    servo:
                        description: ID of the servo to close. This is 0-indexed.
                        type: integer
                        minimum: 0

